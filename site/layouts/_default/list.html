{{ define "main" }}

{{ $homepage := site.GetPage "section" "/" }}
{{ $title := $homepage.Params.title | default "David Majury Wightman" }}
{{ $fontcolor := $homepage.Params.textcolor | default "white" }}

<div id="gallery-container" style="display: flex; align-items: center; justify-content: center; height: 100vh; position: relative;">
    
    <!-- Left Arrow -->
    <div id="left-arrow" class="gallery-arrow" style="cursor: pointer; font-size: 2rem; padding: 0 20px; color: {{ $fontcolor }};">&#9664;</div>
    
    <!-- Image and Label -->
    <div id="gallery-content" style="width: 75%; text-align: center;">
        <div id="gallery-image" style="position: relative;">
            <img id="main-image" src="{{ with index .Pages 0 }}{{ .Params.image }}{{ end }}" alt="{{ with index .Pages 0 }}{{ .Title }}{{ end }}" style="max-width: 100%; height: auto;">
        </div>
        <div id="gallery-label" style="color: white; margin-top: 20px; font-family: 'Helvetica Neue', 'Helvetica', 'Arial', sans-serif; text-align: left; width: 50%; ">
            <p id="image-title" style="color: white; margin: 0; font-style: italic;">{{ with index .Pages 0 }}{{ .Title }}{{ end }} ({{ with index .Pages 0 }}{{ .Params.year }}{{ end }})</p>
            <p id="image-medium" style="color: white; margin: 0;">{{ with index .Pages 0 }}{{ .Params.medium }}{{ end }}</p>
            <p id="image-dimensions" style="color: white; margin: 0;">{{ with index .Pages 0 }}{{ .Params.dimensions }}{{ end }}</p>
            {{ with index .Pages 0 }}
                {{ if gt (len .Content) 1 }}
                    <p id="info-button" style="cursor: pointer; color: white; margin: 0; text-decoration: underline;">more information</p>
                {{ end }}
            {{ end }}
        </div>
    </div>
    
    <!-- Right Arrow -->
    <div id="right-arrow" class="gallery-arrow" style="cursor: pointer; font-size: 2rem; padding: 0 20px; color: {{ $fontcolor }};">&#9654;</div>
</div>

{{ with index .Pages 0 }}
    {{ if gt (len .Content) 1 }}
        <div id="info-modal">
            <div>
                <div style="background-color: {{ $fontcolor }};">
                    <span id="close-modal" >&times;</span>
                    <div>
                        {{ .Content }}
                    </div>
                </div>
            </div>
        </div>
    {{ end }}
{{ end }}


<script>
document.addEventListener('DOMContentLoaded', function() {
    const pages = JSON.parse('{{ .Pages | jsonify | safeJS }}');
    let currentIndex = 0;
    let isAnimating = false;

    const mainImage = document.getElementById('main-image');
    const imageTitle = document.getElementById('image-title');
    const imageMedium = document.getElementById('image-medium');
    const imageDimensions = document.getElementById('image-dimensions');

    const infoButton = document.getElementById('info-button');
    const infoModal = document.getElementById('info-modal');
    const closeModal = document.getElementById('close-modal');

    mainImage.src = mainImage.src.replace('/site/static', '');

    // Show modal on info button click
    if (infoButton && infoModal && closeModal) {
        infoButton.addEventListener('click', function() {
            infoModal.style.display = 'flex';
        });

        // Close modal on close button click
        closeModal.addEventListener('click', function() {
            infoModal.style.display = 'none';
        });

        // Close modal when clicking outside the content box
        window.addEventListener('click', function(event) {
            if (event.target == infoModal) {
                infoModal.style.display = 'none';
            }
        });
    }

    // Handle swipe gestures
    let startX = 0;
    let endX = 0;

    mainImage.addEventListener('touchstart', function(event) {
        startX = event.touches[0].clientX;
    });

    mainImage.addEventListener('touchmove', function(event) {
        endX = event.touches[0].clientX;
    });

    mainImage.addEventListener('touchend', function() {
        if (isAnimating) return;

        const deltaX = endX - startX;
        if (Math.abs(deltaX) > 50) { // Swipe distance threshold
            if (deltaX > 0) {
                navigateGallery(-1); // Swipe right, go to previous image
            } else {
                navigateGallery(1); // Swipe left, go to next image
            }
        }
    });

    function updateGallery(index) {
        if (index >= 0 && index < pages.length) {
            const page = pages[index];

            mainImage.classList.add('slide-out');
            isAnimating = true;

            mainImage.addEventListener('animationend', function handleSlideOut() {
                mainImage.classList.remove('slide-out');
                mainImage.classList.add('slide-in');

                mainImage.src = page.Params.image.replace('/site/static', '');
                mainImage.alt = page.Title;
                imageTitle.textContent = `${page.Title} (${page.Params.year})`;
                imageMedium.textContent = page.Params.medium;
                imageDimensions.textContent = page.Params.dimensions;

                mainImage.addEventListener('animationend', function handleSlideIn() {
                    mainImage.classList.remove('slide-in');
                    isAnimating = false;
                    mainImage.removeEventListener('animationend', handleSlideIn);
                });

                mainImage.removeEventListener('animationend', handleSlideOut);
            });
        } else {
            console.error("Index out of bounds:", index);
        }
    }

    function navigateGallery(direction) {
        if (isAnimating) return;

        currentIndex += direction;

        if (currentIndex < 0) {
            currentIndex = pages.length - 1;
        } else if (currentIndex >= pages.length) {
            currentIndex = 0;
        }

        updateGallery(currentIndex);
    }

    document.getElementById('left-arrow').addEventListener('click', function() {
        navigateGallery(-1);
    });

    document.getElementById('right-arrow').addEventListener('click', function() {
        navigateGallery(1);
    });

    // Initialize gallery with the first image
    // updateGallery(currentIndex);
});

</script>

{{ end }}
